import requests
import json
import numpy as np
from sklearn.svm import SVR
import matplotlib.pyplot as plt

def byteify(input):
     if isinstance(input, dict):
         return {byteify(key):byteify(value) for key,value in input.iteritems()}
     elif isinstance(input, list):
         return [byteify(element) for element in input]
     elif isinstance(input, unicode):
         return input.encode('utf-8')
     else:
         return input

# r = requests.get("https://api.github.com/repos/joeyism/node-checkout-cli/commits")
r = '{"total": [[1439179200000,1],[1439092800000,2],[1439006400000,0],[1438920000000,0],[1438833600000,0],[1438747200000,0],[1438660800000,0],[1438574400000,0],[1438488000000,0],[1438401600000,0],[1438315200000,2],[1438228800000,0],[1438142400000,0],[1438056000000,4],[1437969600000,0],[1437883200000,0],[1437796800000,0],[1437710400000,0],[1437624000000,0],[1437537600000,0],[1437451200000,0],[1437364800000,0],[1437278400000,4],[1437192000000,0],[1437105600000,0],[1437019200000,0],[1436932800000,0],[1436846400000,0],[1436760000000,0],[1436673600000,0],[1436587200000,3],[1436500800000,0],[1436414400000,0],[1436328000000,0],[1436241600000,0],[1436155200000,0],[1436068800000,0],[1435982400000,0],[1435896000000,0],[1435809600000,0],[1435723200000,0],[1435636800000,0],[1435550400000,0],[1435464000000,0],[1435377600000,0],[1435291200000,0],[1435204800000,0],[1435118400000,0],[1435032000000,0],[1434945600000,0],[1434859200000,0],[1434772800000,0],[1434686400000,0],[1434600000000,0],[1434513600000,0],[1434427200000,0],[1434340800000,0],[1434254400000,0],[1434168000000,0],[1434081600000,0],[1433995200000,0],[1433908800000,0],[1433822400000,0],[1433736000000,0],[1433649600000,0],[1433563200000,0],[1433476800000,0],[1433390400000,0],[1433304000000,0],[1433217600000,0],[1433131200000,0],[1433044800000,0],[1432958400000,0],[1432872000000,0],[1432785600000,0],[1432699200000,0],[1432612800000,0],[1432526400000,0],[1432440000000,0],[1432353600000,0],[1432267200000,0],[1432180800000,0],[1432094400000,0],[1432008000000,0],[1431921600000,0],[1431835200000,0],[1431748800000,0],[1431662400000,0],[1431576000000,0],[1431489600000,0],[1431403200000,0],[1431316800000,0],[1431230400000,0],[1431144000000,0],[1431057600000,0],[1430971200000,0],[1430884800000,0],[1430798400000,0],[1430712000000,0],[1430625600000,0],[1430539200000,0],[1430452800000,0],[1430366400000,0],[1430280000000,0],[1430193600000,0],[1430107200000,0],[1430020800000,0],[1429934400000,0],[1429848000000,0],[1429761600000,0],[1429675200000,0],[1429588800000,0],[1429502400000,0],[1429416000000,0],[1429329600000,0],[1429243200000,0],[1429156800000,0],[1429070400000,0],[1428984000000,0],[1428897600000,0],[1428811200000,0],[1428724800000,0],[1428638400000,0],[1428552000000,0],[1428465600000,0],[1428379200000,0],[1428292800000,0],[1428206400000,0],[1428120000000,0],[1428033600000,0],[1427947200000,0],[1427860800000,0],[1427774400000,0],[1427688000000,0],[1427601600000,0],[1427515200000,0],[1427428800000,0],[1427342400000,0],[1427256000000,0],[1427169600000,0],[1427083200000,0],[1426996800000,0],[1426910400000,0],[1426824000000,0],[1426737600000,0],[1426651200000,0],[1426564800000,0],[1426478400000,0],[1426392000000,0],[1426305600000,0],[1426219200000,0],[1426132800000,0],[1426046400000,0],[1425960000000,0],[1425873600000,0],[1425787200000,0],[1425700800000,0],[1425614400000,0],[1425528000000,0],[1425441600000,0],[1425355200000,0],[1425268800000,0],[1425182400000,0],[1425096000000,0],[1425009600000,0],[1424923200000,0],[1424836800000,0],[1424750400000,0],[1424664000000,0],[1424577600000,0],[1424491200000,0],[1424404800000,0],[1424318400000,0],[1424232000000,0],[1424145600000,0],[1424059200000,0],[1423972800000,0],[1423886400000,0],[1423800000000,0],[1423713600000,0],[1423627200000,0],[1423540800000,0],[1423454400000,0],[1423368000000,0],[1423281600000,0],[1423195200000,0],[1423108800000,0],[1423022400000,0],[1422936000000,0],[1422849600000,0],[1422763200000,0],[1422676800000,0],[1422590400000,0],[1422504000000,0],[1422417600000,0],[1422331200000,0],[1422244800000,0],[1422158400000,0],[1422072000000,2],[1421985600000,0],[1421899200000,0],[1421812800000,0],[1421726400000,0],[1421640000000,0],[1421553600000,0],[1421467200000,0],[1421380800000,0],[1421294400000,0],[1421208000000,0],[1421121600000,0],[1421035200000,0],[1420948800000,0],[1420862400000,0],[1420776000000,0],[1420689600000,0],[1420603200000,0],[1420516800000,0],[1420430400000,0],[1420344000000,0],[1420257600000,0],[1420171200000,0],[1420084800000,0],[1419998400000,0],[1419912000000,0],[1419825600000,0],[1419739200000,0],[1419652800000,0],[1419566400000,0],[1419480000000,0],[1419393600000,0],[1419307200000,0],[1419220800000,0],[1419134400000,0],[1419048000000,0],[1418961600000,0],[1418875200000,0],[1418788800000,0],[1418702400000,0],[1418616000000,0],[1418529600000,0],[1418443200000,0],[1418356800000,0],[1418270400000,0],[1418184000000,0],[1418097600000,0],[1418011200000,0],[1417924800000,0],[1417838400000,0],[1417752000000,0],[1417665600000,0],[1417579200000,0],[1417492800000,0],[1417406400000,0],[1417320000000,0],[1417233600000,0],[1417147200000,0],[1417060800000,0],[1416974400000,0],[1416888000000,0],[1416801600000,0],[1416715200000,0],[1416628800000,0],[1416542400000,0],[1416456000000,0],[1416369600000,0],[1416283200000,0],[1416196800000,0],[1416110400000,0],[1416024000000,0],[1415937600000,0],[1415851200000,0],[1415764800000,0],[1415678400000,0],[1415592000000,0],[1415505600000,0],[1415419200000,0],[1415332800000,0],[1415246400000,0],[1415160000000,0],[1415073600000,0],[1414987200000,0],[1414900800000,0],[1414814400000,0],[1414728000000,0],[1414641600000,0],[1414555200000,0],[1414468800000,0],[1414382400000,0],[1414296000000,0],[1414209600000,0],[1414123200000,0],[1414036800000,0],[1413950400000,0],[1413864000000,0],[1413777600000,0],[1413691200000,0],[1413604800000,0],[1413518400000,0],[1413432000000,0],[1413345600000,0],[1413259200000,0],[1413172800000,0],[1413086400000,0],[1413000000000,0],[1412913600000,0],[1412827200000,0],[1412740800000,0],[1412654400000,0],[1412568000000,0],[1412481600000,0],[1412395200000,0],[1412308800000,0],[1412222400000,0],[1412136000000,0],[1412049600000,0],[1411963200000,0],[1411876800000,0],[1411790400000,0],[1411704000000,0],[1411617600000,0],[1411531200000,0],[1411444800000,0],[1411358400000,0],[1411272000000,0],[1411185600000,0],[1411099200000,0],[1411012800000,0],[1410926400000,0],[1410840000000,0],[1410753600000,0],[1410667200000,0],[1410580800000,0],[1410494400000,0],[1410408000000,0],[1410321600000,0],[1410235200000,0],[1410148800000,0],[1410062400000,0],[1409976000000,0],[1409889600000,0],[1409803200000,0],[1409716800000,0],[1409630400000,0],[1409544000000,0],[1409457600000,0],[1409371200000,0],[1409284800000,0],[1409198400000,0],[1409112000000,0],[1409025600000,0],[1408939200000,0],[1408852800000,0],[1408766400000,0],[1408680000000,0],[1408593600000,0],[1408507200000,0],[1408420800000,0],[1408334400000,0],[1408248000000,0],[1408161600000,0],[1408075200000,0],[1407988800000,0],[1407902400000,0],[1407816000000,0],[1407729600000,0],[1407643200000,0]]}';
#commitsArr = byteify(json.loads(r.text))
#for commitsObj in commitsArr:
#    print commitsObj["commit"]["committer"]["date"]
dates = json.loads(r)
data = np.array(dates["total"])
tempx = data[:,0]
y = data[:,1]
x = []
for i, val in enumerate(tempx):
        x.append([val])

x = np.array(x)
length = len(y)
day = 1000*60*60*24
lastday = x[0]
z = np.array(lastday + 40*day*np.random.rand(40,1))

svr_rbf= SVR(kernel = 'rbf', C=1e3, gamma=0.1)
y_rbf = svr_rbf.fit(x,y).predict(z)

plt.hold('on')
plt.plot(x,y, c='g', label='data')
plt.plot(z,y_rbf, c='r', label='rbf model')
plt.xlabel('time')
plt.ylabel('no of commits')
#plt.axis([x[length-1], x[0], 0, 8])
plt.legend()
plt.show()

